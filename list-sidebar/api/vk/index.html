<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VK Messages - List + Sidebar - API</title>
    <link rel="stylesheet" href="../../../shared/css/operator.css">

    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel Standalone for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script src="../../../shared/js/auth-utils.js"></script>
    <script src="../../../shared/js/ui-components.js"></script>
    <script type="text/babel">
        // Custom content renderer for VK messages
        function renderVKContent(item) {
            return React.createElement('div', null,
                React.createElement('div', { className: 'message-content' }, item.text),
                React.createElement('div', { className: 'message-meta' },
                    React.createElement('div', null,
                        React.createElement('strong', null, 'From: '),
                        item.first_name,
                        ' (ID: ', item.user_id, ')'
                    ),
                    React.createElement('div', null,
                        React.createElement('span', {
                            style: {
                                background: '#07f',
                                padding: '0.25rem 0.5rem',
                                borderRadius: '0.25rem',
                                fontSize: '0.75rem',
                                color: 'white'
                            }
                        }, 'UNREAD')
                    )
                )
            );
        }

        // Fetch VK data (using mock data for demo)
        async function fetchVKData() {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1000));

            // In a real app, you would:
            // 1. Authenticate with VK API
            // 2. Fetch unread messages
            // const response = await fetch(`https://api.vk.com/method/messages.get?filter=1&access_token=${token}&v=5.131`);

            // For demo, use mock data
            const messages = MockDataGenerators.vk.generateMessages(8);

            // Format data
            return messages.map(msg => {
                const timeAgo = Date.now() / 1000 - msg.date;
                const hours = Math.floor(timeAgo / 3600);

                return {
                    ...msg,
                    source: 'VK',
                    type: 'Private Message',
                    title: `Message from ${msg.first_name}`,
                    content: msg.text,
                    time: hours < 1 ? 'Just now' :
                           hours < 24 ? `${hours}h ago` :
                           `${Math.floor(hours / 24)}d ago`,
                    timeAgo: hours < 1 ? 'Just now' :
                            hours < 24 ? `${hours}h ago` :
                            `${Math.floor(hours / 24)}d ago`
                };
            });
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            React.createElement(ListSidebarApp, {
                title: 'VK Private Messages',
                fetchData: fetchVKData,
                renderContent: renderVKContent,
                platform: 'VK'
            })
        );
    </script>
</body>
</html>
